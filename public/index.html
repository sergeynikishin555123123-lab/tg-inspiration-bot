<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ú–∞—Å—Ç–µ—Ä—Å–∫–∞—è –í–¥–æ—Ö–Ω–æ–≤–µ–Ω–∏—è</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { 
            font-family: Arial, sans-serif; 
            background: linear-gradient(135deg, #667eea, #764ba2);
            min-height: 100vh; 
            padding: 20px;
            color: white;
        }
        .container { max-width: 400px; margin: 0 auto; }
        .card { 
            background: rgba(255,255,255,0.95); 
            border-radius: 15px; 
            padding: 20px; 
            margin: 10px 0; 
            color: #333;
        }
        h1 { text-align: center; margin-bottom: 10px; color: #2d3748; }
        .btn { 
            width: 100%; 
            padding: 15px; 
            background: #667eea; 
            color: white; 
            border: none; 
            border-radius: 10px; 
            font-size: 18px; 
            margin: 5px 0; 
            cursor: pointer;
        }
        .info { padding: 10px 0; border-bottom: 1px solid #eee; }
        .success { background: #48bb78; color: white; padding: 10px; border-radius: 5px; margin: 5px 0; }
        .error { background: #f56565; color: white; padding: 10px; border-radius: 5px; margin: 5px 0; }
        .loading { text-align: center; padding: 20px; color: #666; }
    </style>
</head>
<body>
    <div class="container">
        <div class="card">
            <h1>üé® –ú–∞—Å—Ç–µ—Ä—Å–∫–∞—è –í–¥–æ—Ö–Ω–æ–≤–µ–Ω–∏—è</h1>
            <p style="text-align: center; color: #666;">–í–∞—à –ª–∏—á–Ω—ã–π –∫–∞–±–∏–Ω–µ—Ç</p>
            
            <div id="userData">
                <div class="loading">‚è≥ –ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö...</div>
            </div>
            
            <div id="actions">
                <button class="btn" onclick="loadUserData()">üîÑ –û–±–Ω–æ–≤–∏—Ç—å</button>
                <button class="btn" onclick="testAPI()">üîç –¢–µ—Å—Ç API</button>
                <button class="btn" onclick="showCharacters()">üë• –ü–µ—Ä—Å–æ–Ω–∞–∂–∏</button>
            </div>
            
            <div id="results"></div>
        </div>
    </div>

    <script>
        const API_URL = 'http://localhost:3000';
        
        // –ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
        async function loadUserData() {
            showMessage('‚è≥ –ó–∞–≥—Ä—É–∑–∫–∞...', 'loading');
            
            try {
                // –¢–µ—Å—Ç–æ–≤—ã–π ID
                const userId = 12345;
                
                const response = await fetch(`${API_URL}/api/users/${userId}`);
                const data = await response.json();
                
                const user = data.user;
                document.getElementById('userData').innerHTML = `
                    <div class="info"><strong>ID:</strong> ${user.user_id}</div>
                    <div class="info"><strong>–ò–º—è:</strong> ${user.tg_first_name || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ'}</div>
                    <div class="info"><strong>–ó–≤—ë–∑–¥—ã:</strong> ${user.stars} ‚≠ê</div>
                    <div class="info"><strong>–£—Ä–æ–≤–µ–Ω—å:</strong> ${user.level}</div>
                    <div class="info"><strong>–°—Ç–∞—Ç—É—Å:</strong> ${user.is_registered ? '‚úÖ –ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω' : '‚ùå –ù–µ –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω'}</div>
                `;
                
                showMessage('‚úÖ –î–∞–Ω–Ω—ã–µ –∑–∞–≥—Ä—É–∂–µ–Ω—ã!', 'success');
            } catch (error) {
                document.getElementById('userData').innerHTML = `<div class="error">‚ùå –û—à–∏–±–∫–∞: ${error.message}</div>`;
                showMessage('‚ùå –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏', 'error');
            }
        }
        
        // –¢–µ—Å—Ç API
        async function testAPI() {
            showMessage('üîç –¢–µ—Å—Ç–∏—Ä—É–µ–º API...', 'loading');
            
            const endpoints = [
                { name: 'Health', url: '/health' },
                { name: '–ü–µ—Ä—Å–æ–Ω–∞–∂–∏', url: '/api/webapp/characters' },
                { name: '–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏', url: '/api/users/12345' }
            ];
            
            for (const endpoint of endpoints) {
                try {
                    const response = await fetch(API_URL + endpoint.url);
                    const data = await response.json();
                    console.log(`‚úÖ ${endpoint.name}:`, data);
                } catch (error) {
                    console.log(`‚ùå ${endpoint.name}:`, error.message);
                    showMessage(`‚ùå ${endpoint.name}: ${error.message}`, 'error');
                    return;
                }
            }
            
            showMessage('‚úÖ –í—Å–µ API —Ä–∞–±–æ—Ç–∞—é—Ç!', 'success');
        }
        
        // –ü–æ–∫–∞–∑–∞—Ç—å –ø–µ—Ä—Å–æ–Ω–∞–∂–µ–π
        async function showCharacters() {
            showMessage('üë• –ó–∞–≥—Ä—É–∑–∫–∞ –ø–µ—Ä—Å–æ–Ω–∞–∂–µ–π...', 'loading');
            
            try {
                const response = await fetch(API_URL + '/api/webapp/characters');
                const data = await response.json();
                
                let html = '<h3>üë• –ü–µ—Ä—Å–æ–Ω–∞–∂–∏:</h3>';
                Object.keys(data).forEach(className => {
                    html += `<h4>${className}</h4>`;
                    data[className].forEach(char => {
                        html += `<div style="border: 1px solid #ddd; padding: 10px; margin: 5px 0; border-radius: 5px;">
                            <strong>${char.character_name}</strong><br>
                            <small>${char.description}</small>
                        </div>`;
                    });
                });
                
                document.getElementById('results').innerHTML = html;
                showMessage('‚úÖ –ü–µ—Ä—Å–æ–Ω–∞–∂–∏ –∑–∞–≥—Ä—É–∂–µ–Ω—ã!', 'success');
            } catch (error) {
                showMessage(`‚ùå –û—à–∏–±–∫–∞: ${error.message}`, 'error');
            }
        }
        
        // –ü–æ–∫–∞–∑–∞—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ
        function showMessage(text, type) {
            const div = document.createElement('div');
            div.className = type;
            div.textContent = text;
            document.getElementById('results').appendChild(div);
            setTimeout(() => div.remove(), 5000);
        }
        
        // –ê–≤—Ç–æ–∑–∞–≥—Ä—É–∑–∫–∞ –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ
        document.addEventListener('DOMContentLoaded', () => {
            console.log('üöÄ –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –∑–∞–ø—É—â–µ–Ω–æ');
            loadUserData();
        });
    </script>
</body>
</html>
